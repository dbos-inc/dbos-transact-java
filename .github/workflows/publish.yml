name: Publish

on:
  workflow_call:
   secrets:
    USERNAME_MAVEN:
      required: true
    TOKEN_MAVEN:
      required: true
  workflow_dispatch:

jobs:
  public:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/heads/release/v')
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # fetch-depth 0 needed for version calculation

      - name: Set up OpenJDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Publish
        run: ./gradlew publish
        env:
          # GitHub Packages credentials stored as repository secrets
          USERNAME_MAVEN: ${{ secrets.USERNAME_MAVEN }}
          TOKEN_MAVEN: ${{ secrets.TOKEN_MAVEN }}
